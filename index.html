<!DOCTYPE html>
<html>
<head>
  <title>Supabase Knowledge Bot</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { padding: 10px; margin-top: 10px; }
    #chat { margin-top: 20px; }
    .user { color: blue; }
    .bot { color: green; }
  </style>
</head>
<body>
  <h2>ü§ñ Supabase Knowledge Bot</h2>
  <input id="userInput" type="text" placeholder="Type your question..." />
  <button onclick="sendMessage()">Send</button>

  <div id="chat"></div>

  <script>
    // ‚úÖ Supabase Setup
    const SUPABASE_URL = "https://ejkhouvldirbkhblmfwg.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqa2hvdXZsZGlyYmtoYmxtZndnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxNjgyNzIsImV4cCI6MjA2Nzc0NDI3Mn0.OR42hMgpcj2GmXjbhfNjA9BbAfRiAPhSEoFW_mPpWQc";

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let knowledgeMode = false;
    let knowledgeBase = {};

    // ‚úÖ Load Knowledge Base from Supabase
    async function loadKnowledgeBase() {
      const { data, error } = await supabase
        .from('knowledge_base')
        .select('question, answer');

      if (error) {
        console.error("Error loading KB:", error);
      } else {
        data.forEach(item => {
          knowledgeBase[item.question.toLowerCase()] = item.answer;
        });
        console.log("üìö Knowledge Base Loaded");
      }
    }

    loadKnowledgeBase(); // Load on page start

    // ‚úÖ Message Handling
    function sendMessage() {
      const input = document.getElementById("userInput");
      const text = input.value.trim().toLowerCase();
      if (!text) return;

      addMessage("üßë You", text);

      if (text === "active knowledge mood" || text === "‡¶®‡¶≤‡ßá‡¶ú ‡¶Æ‡ßÅ‡¶°‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞") {
        knowledgeMode = true;
        addMessage("ü§ñ Bot", "‚úÖ Knowledge Mode Activated!");
      } else if (text === "cancel knowledge" || text === "‡¶®‡¶≤‡ßá‡¶ú ‡¶Æ‡ßÅ‡¶° ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞") {
        knowledgeMode = false;
        addMessage("ü§ñ Bot", "‚ùå Knowledge Mode Cancelled!");
      } else {
        if (knowledgeMode) {
          const reply = knowledgeBase[text];
          if (reply) {
            addMessage("ü§ñ Bot", reply);
          } else {
            addMessage("ü§ñ Bot", "üîç ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ knowledge base-‡¶è ‡¶®‡ßá‡¶á‡•§");
          }
        } else {
          addMessage("ü§ñ Bot", `üåê ‡¶¨‡¶æ‡¶á‡¶∞‡ßá‡¶∞ ‡¶â‡ßé‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶â‡¶§‡ßç‡¶§‡¶∞: '${text}' ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶§‡¶•‡ßç‡¶Ø ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`);
        }
      }

      input.value = "";
    }

    function addMessage(sender, text) {
      const chat = document.getElementById("chat");
      const msg = document.createElement("div");
      msg.className = sender.includes("You") ? "user" : "bot";
      msg.innerHTML = `<strong>${sender}:</strong> ${text}`;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }
  </script>
</body>
</html>